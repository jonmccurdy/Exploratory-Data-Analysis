{"title":"Control Flow and Functions","markdown":{"headingText":"Control Flow and Functions","containsRefs":false,"markdown":"\nIn this section we move from writing expressions that return TRUE/FALSE to writing code that returns useful outputs. You will learn how to make decisions in R using conditional statements, how to build your own functions, and how to repeat a process using loops and apply-style functions. By the end, you should be able to write small R programs that take input, make choices, repeat steps when needed, and summarize results across groups in a data frame.\n\n::: learning-goals\n\n- Use `ifelse()` statements to return a character or numeric value based on a condition\n- Write your own functions using `function()` with parameters and a return value\n- Use `while()` and `for()` loops to repeat a process, and recognize how infinite loops happen\n- Use `apply()`, `lapply()`, and `sapply()` to ‚Äúapply‚Äù a function across rows/columns, vectors, or lists\n- Use `tapply()` and `aggregate()` to compute summary statistics by group\n:::\n\n::: {.callout-tip}\n## Supplemental Material\n<a href=\"Reading-Guide/L5-Reading-Guide.pdf\" download>\nüìÑ Download the lecture's Reading Guide\n</a>\n:::\n\n## Conditional Statements\n\nWe previously discussed how to use conditional statements to identify elements that meet certain criteria, which results in a vector of TRUE and FALSEs. We can take this idea a step further and instead of outputting a logical element, we can have it output a certain character or numeric value. To do this we can use the `if()` function paired with the `else()` function. This will check if the criteria is met and if it is it will output the value in the braces, if not then it will output the value in the \"else\" brace. The general format could be thought of as: `if(Condition) {If TRUE do this} else {If FALSE do this}}`\n\n```{r}\na <- 7\na %% 2 == 0\nif (a %% 2 == 0){\"even\"} else {\"odd\"}\n\na <- 12\na %% 2 == 0\nif (a %% 2 == 0){\"even\"} else {\"odd\"}\n```\n\nUsing this idea, we can specify multiple conditions to be checked. For instance, in the example below we first identify if the value is less than 0. If this is true then we identify the value as \"negative\" and if not then we identify if the value is greater than 0. If this is true then we label the value as \"positive\" and if neither of those conditions are met then we specify it as \"neither\".\n\n```{r}\na <- -5\nif (a < 0){\"negative\"\n  } else if (a > 0) {\"positive\"\n  } else {\"neither\"}\n\na <- 8\nif (a < 0){\"negative\"} else if (a > 0) {\"positive\"} else {\"neither\"}\na <- 0\nif (a < 0){\"negative\"} else if (a > 0) {\"positive\"} else {\"neither\"}\n```\n\nWhile the previous examples were helpful in returning a value depending on if the criteria was met, it only works with a single element at a time. A similar vectorized version exists that collapses the `if()` and `else()` function into the `ifelse()` function. It will work in a similar way: `ifelse(Condition, If TRUE do this, If FALSE do this)`. Like the previous version, this function can also have nested conditional statements.\n\n```{r}\na <- 7\na %% 2 == 0\nifelse( a %% 2 == 0, \"even\", \"odd\")\n\na <- 12\na %% 2 == 0\nifelse( a %% 2 == 0, \"even\", \"odd\")\n\na <- -7\nifelse(a < 0, \"negative\", ifelse(a>0, \"positive\", \"neither\"))\n\na <- c(-7, -0.5, 0, 0.5, 7)\nifelse(a < 0, \"negative\", ifelse(a>0, \"positive\", \"neither\"))\n\ngrade <- c(92, 67, 81, NA)\n\nifelse(is.na(grade), \"missing\", ifelse(grade >= 70, \"pass\", \"not pass\"))\n```\n\n## Functions\n\nWe have relied upon functions throughout our data science journey to calculate statistics, check criteria, and accomplish specific tasks. These were all defined functions available in either base R or a corresponding library, but we can also define our own function. To do this we will use the `function()` function. We first have to specify the function name and then use the assignment operator and point the function towards this name. We then call `function()` and define the variables that will be needed to run the function. Then in the braces, we will specify what needs to be done. We can use the `return()` statement to specify what needs to be outputted, and if we do not specify the output then it will output the last evaluated expression displayed. Examples of a function with one and two variables can be seen below (with both the `return()` statement and without it):\n\n```{r}\nmultiply_by_2 <- function(a) {\n  return(a*2)\n}\n\nmultiply_by_2(6)\nmultiply_by_2(4.53)\n\nmultiply <- function(a,b){\n  a*b\n}\nmultiply(5, 3)\nmultiply(-6.32, 46)\n```\n\nIt should be noted that if an expression is saved to some variable then it will not be outputted automatically without a `return()` statement. But, the value will be outputted if the function is run and saved to some other variable. Additionally, if the function is not set up to output any values but is set up to save values to some variable, then running the function in parenthesis will output the value. You can see below that the first function run does not output any results (unless in parenthesis) but saving it to a variable allows you to access the results. \n\n```{r}\npythagorean <- function(a,b){\n  c <- sqrt(a^2 + b^2)\n}\n\npythagorean(3,4)\nanswer <- pythagorean(3,4)\nanswer\n\n(pythagorean(3,4))\n\npythagorean <- function(a,b){\n  c <- sqrt(a^2 + b^2)\n  return(c)\n}\npythagorean(3,4)\n```\n\n## Variable Scope Environment\n\nAnother thing that we should think about is the scope of our environment. This means that if we create a variable within a function's environment, then we will not necessarily be accessible in the global environment. If we want to \"force\" it to be available in the global environment then you can use the \"$<<-$\" operator, but be very careful with this operator. We will probably never need to use it in this manner, but I did want to inform you that it is a workaround to access variables outside of functions. Typically if we want to output multiple elements (or at least have them accessible outside of the function environment) then we can store the values in a list and output them that way.\n\n```{r}\npythagorean <- function(a,b){\n  c_value <- sqrt(a^2 + b^2)\n  return(c_value)\n}\npythagorean(3,4)\n```\n\n\n```{r}\n#| eval: FALSE\nc_value\n```\n<span style=\"color: red;font-size: 80%; font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, monospace;\">Error: object &quot;c_value&quot; not found</span>\n\n\n```{r}\npythagorean <- function(a,b){\n  c_value <<- sqrt(a^2 + b^2)\n  return(c_value)\n}\npythagorean(3,4)\nc_value\n```\n\n## Iterations\n\nIn addition to functions, we can also introduce the idea of iterations. While it is more common to use vectorized functions, we often find ourselves in scenarios where iterations make sense to use. These typically consist of the `while()` function and the `for()` function. The syntax for both of these is comparable to many other programming languages.\n\nThe `while()` function will continue running the commands `while` the initial condition is true. We have to be very careful with this though, as it can potentially go on indefinitely if the initial condition is never false. If this ever does happen then you can \"cancel\" the command by hitting the red stop sign in the top right-hand portion of the console. The moral of the story though is that we want to think about (and run the function for an iteration or two in our heads) before we run the code.\n\n```{r}\na <- 4\nwhile(a > 0){\n  print(a)\n  a <- a - 1\n}\n```\n\nMeanwhile, the `for()` function will allow us to iterate a loop `for` a specified number of times. To do this, we will specify the variable, and then say the indices that we want to run. Every time the command is finished it will automatically increase the value to the next index value specified. Below we can see multiple examples of this:\n\n```{r}\nfor(a in 1:3){\n  print(a)\n}\n\nx <- c(6, 8, -2, 5, 2, 2, -13, -5)\nseq(from=1, to=length(x), by=2)\nfor(i in seq(from=1, to=length(x), by=2)){\n  print(x[i])\n}\n\ncount <- 0\nfor(i in 1:length(x)){\n  count <- count + x[i]\n}\ncount\nsum(x)\n```\n\n## Apply Family of Functions\n\nThe `apply()` family of functions can act as a vectorized version of the iterative loops that we just learned. These will `apply` some function over the data. There are multiple different versions of the function, so we will go over each. The basic version is `apply()` which will apply a function over an array's margins. To signify the row the margin will be 1 and to signify a column the margin will be 2. In the example below I have coded it multiple ways, with the first way using for-loops, the second way using the `apply()` function, and the third way using the `colSums()` and `rowSums()` functions. \n\n```{r}\nx <- matrix(sample(1:10, 30, replace=TRUE), nrow=3)\nx\n\ncolumn_Sum <- c()\nfor (i in 1:ncol(x)){\n  sum <- 0\n  for (j in 1:nrow(x)){\n    sum <- sum + x[j,i]\n  }\n  column_Sum[i] <- sum\n}\n\ncolumn_Sum\napply(x, 2, sum)\ncolSums(x)\n\nrow_Sum <- c()\nfor (i in 1:nrow(x)){\n  row_Sum[i] <- sum(x[i,])\n}\nrow_Sum\napply(x, 1, sum)\nrowSums(x)\n```\n\nAnother version is the `lapply()` function which will apply a function over a list or vector. For instance, in the code, we calculate the mean for each vector in a list and output a list in return. We can use the `unlist()` function to coerce the result to be outputted as a vector. The `sapply()` function simplifies the `lapply()` function and by default returns a vector or matrix instead of a list. There are additional functions in the `apply` family, such as the `mapply()` and `vapply()`,  but we will not go into them here.\n\n```{r}\nlist_ex <- list(a=1:10, b=3:5, c=c(2:4,18:22))\nlist_ex\n\nlapply(list_ex, mean)\nunlist(lapply(list_ex, mean))\n\nsapply(list_ex, mean)\n```\n\n## Grouping Functions\n\nIt is beneficial in R to occasionally perform summary statistics on different groups within a table or data.frame. For instance, we may want to calculate the average height of males and females. This can be done using either the `tapply()` function or the `aggregate()` function. The `tapply()` function allows us to specify what we want to do the \"math\" on and then specify that category we want to divide into groups. The`aggregate()` function will work in a similar manner, the main difference being that we have to pass the arguments as a list. \n\n```{r}\nstudents <- data.frame(student_num = 1:100,\n      major = sample(c(\"Math\", \"Data\", \"cyber\"), 100, replace=TRUE),\n      gender = sample(c(\"Male\", \"Female\"), 100, replace=TRUE),\n      score = rnorm(100, 70, 10))\n\nhead(students)\n \ntapply(students$score, students$major, mean)\naggregate(students$score, by=list(Major=students$major), mean)\n```\n\nThe `aggregate()` function is a little more powerful in that we can pass in multiple grouping arguments to divide the data. For instance, in the example below we find the mean score for students by major along with their gender.\n\n```{r}\naggregate(students$score, by=list(Major=students$major,\n                                  Gender = students$gender), mean)\n```\n","srcMarkdownNoYaml":""},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["callout_custom.css","style.css"],"output-file":"Lecture-5-Control-Flow-and-Functions.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.7.29","bibliography":["references.bib"],"editor":"visual","theme":"cosmo","math":"mathjax"},"extensions":{"book":{"multiFile":true}}},"pdf":{"identifier":{"display-name":"PDF","target-format":"pdf","base-format":"pdf"},"execute":{"fig-width":5.5,"fig-height":3.5,"fig-format":"pdf","fig-dpi":300,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"pdf","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":true,"merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"pdf-engine":"xelatex","standalone":true,"variables":{"graphics":true,"tables":true},"default-image-extension":"pdf","to":"pdf","output-file":"Lecture-5-Control-Flow-and-Functions.pdf"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"block-headings":true,"bibliography":["references.bib"],"editor":"visual","documentclass":"scrreprt"},"extensions":{"book":{"selfContainedOutput":true}}}},"projectFormats":["html","pdf"]}